# Instalación de gestores de contenidos
- Conceptos generales y casuística de uso recomendado.
- Tipos de gestores de contenidos: portales, de enseñanza, blogs, wikis, foros…
- Licencias de uso.
- Requerimientos de funcionamiento: servidor web, lenguaje de script, sistema gestor de bases de datos,…
- Instalación.
- Creación de la base de datos.
- Estructura.
- Creación de contenidos.
- Personalización de la interfaz.
- Mecanismos de seguridad integrados: control de acceso, usuarios…
- Verificación del rendimiento y funcionamiento.
- Publicación.

-----------

# Hosts virtuales. Creación, configuración y utilización

-----------

# Práctica con Raspberry miércoles

-----------

# Un poco de PHP
* https://www.jesusninoc.com/02/20/php-en-powershell-con-ejemplos/
* https://www.jesusninoc.com/01/06/ejecutar-un-cmdlet-de-powershell-desde-php/
* https://www.jesusninoc.com/04/05/resumen-de-las-operaciones-con-memoria-compartida-en-php/
* https://www.jesusninoc.com/04/03/ejecutar-un-codigo-sobre-un-contenedor-docker-con-php-y-la-extension-pthreads/

# Crear una página web en HTML leyendo de una base de datos con PowerShell
## Ayuda
### Crear una web simple pidiendo al usuario un valor
```PowerShell
"<html><title>"+(Read-Host "Introduzca título")+"</title></html>" | Out-File web.html
start chrome .\web.html
```
### Arrancar y conectar a MySQL desde PowerShell
* https://www.jesusninoc.com/03/18/arrancar-y-conectar-a-mysql-desde-powershell/

## Solución Enrique Carreras
```PowerShell
$quien = Read-Host "Escribe tu nombre: "

[void][System.Reflection.Assembly]::LoadWithPartialName("MySql.Data")
$Connection = New-Object MySql.Data.MySqlClient.MySqlConnection
$ConnectionString = "server=" + "localhost" + ";port=3306;uid=" + "root" +";database="+"bbdd"
$Connection.ConnectionString = $ConnectionString
$Connection.Open()

$Query='select * from alumnos where nombre = "'+$quien+'"'
$Command = New-Object MySql.Data.MySqlClient.MySqlCommand($Query, $Connection)
$DataAdapter = New-Object MySql.Data.MySqlClient.MySqlDataAdapter($Command)
$DataSet = New-Object System.Data.DataSet
$RecordCount = $dataAdapter.Fill($dataSet, "data")
$DataSet.Tables[0]
$Connection.Close() 

"<html><title>Resultado</title>
<body>
    <table>
        <tr><td>Nombre</td><td>DNI</td><td>Tlf</td></tr>
        <tr><td> "+$DataSet.Tables[0].nombre+" </td><td> "+$DataSet.Tables[0].dni+" </td><td> "+$DataSet.Tables[0].tlf+" </td></tr>
    </table>
</body>
</html>" | Out-File web.html
start firefox .\web.html
```

# Instalación de gestores de contenidos con WP-CLI (WordPress Command Line Interface)
* https://desarrollowp.com/blog/tutoriales/wp-cli-parte-1-instalacion-primeros-pasos/

-----------------
-----------------

# Instalación de gestores de contenidos
- Conceptos generales y casuística de uso recomendado.
- Tipos de gestores de contenidos: portales, de enseñanza, blogs, wikis, foros…
- Licencias de uso.
- Requerimientos de funcionamiento: servidor web, lenguaje de script, sistema gestor de bases de datos,…
- Instalación.
- Creación de la base de datos.
- Estructura.
- Creación de contenidos.
- Personalización de la interfaz.
- Mecanismos de seguridad integrados: control de acceso, usuarios…
- Verificación del rendimiento y funcionamiento.
- Publicación. 

--------------------

# Instalación de gestores de contenidos con WP-CLI (WordPress Command Line Interface)
* https://desarrollowp.com/blog/tutoriales/wp-cli-parte-1-instalacion-primeros-pasos/
* https://desarrollowp.com/blog/tutoriales/wp-cli-parte-2-instalando-wordpress-paso-paso-primeras-configuraciones/

# Crear un script que instale WordPress mediante la línea de comandos WP-CLI
```PowerShell
# Añadir al path las rutas C:\xampp\mysql\bin y C:\xampp\php
$var = "juan","irene","lucas","maría","pedro"
cd C:\xampp\htdocs\wp
foreach($usuarios in $var)
{
    $usuarios
    New-Item -ItemType Directory -Name $usuarios -Force
    cd C:\xampp\htdocs\wp\$usuarios
    php.exe C:\xampp\php\wp-cli.phar core download
    php.exe C:\xampp\php\wp-cli.phar config create --dbname=labasededatosquequierastu --dbuser=root
    # Una vez creado el fichero wp-config.php con el comando wp config create --dbname=wptest --dbuser=miusuario --dbpass=miclave --locale=es_ES
    # Crea la base de datos con la estructura de WordPress
    php.exe C:\xampp\php\wp-cli.phar db create
    php.exe C:\xampp\php\wp-cli.phar core install --url=localhost:81/usuarios/$usuarios --title="Este es el sitio de usuario" --admin_user=mi_usuario --admin_password=mi_contraseña --admin_email=mi@email.com 
    cd ..
}
```

------------------
------------------

# Instalación de gestores de contenidos
- Conceptos generales y casuística de uso recomendado.
- Tipos de gestores de contenidos: portales, de enseñanza, blogs, wikis, foros…
- Licencias de uso.
- Requerimientos de funcionamiento: servidor web, lenguaje de script, sistema gestor de bases de datos,…
- Instalación.
- Creación de la base de datos.
- Estructura.
- Creación de contenidos.
- Personalización de la interfaz.
- Mecanismos de seguridad integrados: control de acceso, usuarios…
- Verificación del rendimiento y funcionamiento.
- Publicación. 

--------------------

# Instalación de gestores de contenidos con WP-CLI (WordPress Command Line Interface)
## Instalando y activando plugins
* https://desarrollowp.com/blog/tutoriales/wp-cli-parte-2-instalando-wordpress-paso-paso-primeras-configuraciones/

## Trabajar con posts
* https://desarrollowp.com/blog/tutoriales/wp-cli-parte-3-trabajando-posts/
## wp import (Imports content from a given WXR file)
* https://developer.wordpress.org/cli/commands/import/


--------------------

# Ejercicios
## Crear posts en Wordpress de forma automática leyendo feeds de una página web
```PowerShell
(Invoke-WebRequest "jesusninoc.es/feed/").content | out-file codigoande.txt

[XML]$alumnos = gc .\codigoande.txt
$alumnos.rss.channel.Item | %{
    $titiulo = $_.title
    $texto = ($_.encoded | Format-Custom) 
    $texto | Out-File fichero1
    gc fichero1
}

##############################################################

[XML]$alumnos = gc .\codigoande.txt
$alumnos.rss.channel.Item | %{
    $titiulo = $_.title
    $texto = ($_.encoded | Format-Custom) 
    $texto | Out-File fichero1
    $textofinal=gc fichero1
    $textofinal[1..100]
}

##############################################################

(Invoke-WebRequest "jesusninoc.es/feed/").content | out-file codigoande.txt

[XML]$alumnos = gc .\codigoande.txt
$alumnos.rss.channel.Item | %{
    $titiulo = $_.title
    $texto = ($_.encoded | Format-Custom) 
    $texto | Out-File fichero1
    $textofinal=gc fichero1
    wp post create --post_title=$titiulo --post_content=($textofinal[2]) --post_type="post"
    Start-Sleep -Seconds 5
}
```

## Crear posts en Wordpress de forma automática leyendo feeds de una página web (solución Enrique Carreras)
```PowerShell
(Invoke-WebRequest "jesusninoc.com/feed/").content | Out-File -FilePath C:\Users\Administrador\Desktop\jes.txt


$laclase = "et_pb_text et_pb_module et_pb_bg_layout_light et_pb_text_align_left  et_pb_text_"
$n = 1

[XML]$alumnos = gc C:\Users\Administrador\Desktop\jes.txt
    $alumnos.rss.channel.Item | %{
    $titulo = $_.title
    
    $url="andel.es/feed/"
    $result = Invoke-WebRequest $url
    #$texto=$result.AllElements | Where class -eq "et_pb_text et_pb_module et_pb_bg_layout_light et_pb_text_align_left  et_pb_text_2" | %{$_.innerText} | Out-File  C:\Users\Administrador\Desktop\contenido.txt
    $texto=$result.AllElements | Where class -eq ($laclase+$n) | %{$_.innerText} 

    $n++

    cd C:\xampp\htdocs\Usuarios\juan
    php C:\xampp\htdocs\wptest\wp-cli.phar post create --post_title="$titulo" --post_content="$texto" --post_type="post" --post_status="publish"
```

------------------
------------------

# Instalación de gestores de contenidos
- Conceptos generales y casuística de uso recomendado.
- Tipos de gestores de contenidos: portales, de enseñanza, blogs, wikis, foros…
- Licencias de uso.
- Requerimientos de funcionamiento: servidor web, lenguaje de script, sistema gestor de bases de datos,…
- Instalación.
- Creación de la base de datos.
- Estructura.
- Creación de contenidos.
- Personalización de la interfaz.
- Mecanismos de seguridad integrados: control de acceso, usuarios…
- Verificación del rendimiento y funcionamiento.
- Publicación. 

--------------------

# Posts
## Trabajar con posts
* https://desarrollowp.com/blog/tutoriales/wp-cli-parte-3-trabajando-posts/
## wp import (Imports content from a given WXR file)
* https://developer.wordpress.org/cli/commands/import/

# WP-CLI Commands
* https://developer.wordpress.org/cli/commands/

# Cómo instalar WordPress CLI en alojamiento compartido
* https://es.godaddy.com/help/como-instalar-wordpress-cli-en-alojamiento-compartido-12363

------------------
------------------

# Instalación de gestores de contenidos
- Conceptos generales y casuística de uso recomendado.
- Tipos de gestores de contenidos: portales, de enseñanza, blogs, wikis, foros…
- Licencias de uso.
- Requerimientos de funcionamiento: servidor web, lenguaje de script, sistema gestor de bases de datos,…
- Instalación.
- Creación de la base de datos.
- Estructura.
- Creación de contenidos.
- Personalización de la interfaz.
- Mecanismos de seguridad integrados: control de acceso, usuarios…
- Verificación del rendimiento y funcionamiento.
- Publicación. 

--------------------

# Replicar la estructura de una página web de forma automática
## Enlaces interesantes
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-10-07.md#proyecto-descargar-de-web
* https://www.guyrutenberg.com/2014/05/02/make-offline-mirror-of-a-site-using-wget/
* https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/out-string?view=powershell-6

## Pasos
- Descargar el XML https://www.jesusninoc.com/sitemap-posttype-post.2012.xml
- Recorrer el XML y descargar cada URL
- Almacenar cada URL descargada en la carpeta htdocs de XAMPP
- Añadir el nombre del dominio al fichero hosts relacionando 127.0.0.1 con el dominio C:\Windows\System32\drivers\etc

## Solución
```PowerShell
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
(Invoke-WebRequest "https://www.jesusninoc.com/sitemap-posttype-post.2012.xml").content | out-file codigoande.txt
[XML]$alumnos = gc .\codigoande.txt
$alumnos.urlset.url.loc | %{
  $_
  [String]$partir = $_ | Out-String
  (iwr $_).content | Out-File ($_.split("/")[5]+".html")
##########################################
}
```
